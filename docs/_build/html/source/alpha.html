

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Blending/Overlaying images &mdash; imgaug 0.2.6 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Overview of Augmenters" href="augmenters.html" />
    <link rel="prev" title="Stochastic Parameters" href="parameters.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> imgaug
          

          
          </a>

          
            
            
              <div class="version">
                0.2.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples_basics.html">Examples: Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples_keypoints.html">Examples: Keypoints</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples_bounding_boxes.html">Examples: Bounding Boxes</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Stochastic Parameters</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Blending/Overlaying images</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#constant-alpha">Constant Alpha</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simplexnoisealpha">SimplexNoiseAlpha</a></li>
<li class="toctree-l2"><a class="reference internal" href="#frequencynoisealpha">FrequencyNoiseAlpha</a></li>
<li class="toctree-l2"><a class="reference internal" href="#iterativenoiseaggregator">IterativeNoiseAggregator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sigmoid">Sigmoid</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="augmenters.html">Overview of Augmenters</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">imgaug</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">imgaug</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Blending/Overlaying images</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/source/alpha.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="blending-overlaying-images">
<h1>Blending/Overlaying images<a class="headerlink" href="#blending-overlaying-images" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Most augmenters in the library affect images in uniform ways per image.
Sometimes one might not want that and instead desires more localized effects
(e.g. change the color of some image regions, while keeping the others unchanged)
or wants to keep a fraction of the old image (e.g. blur the image and mix in a bit
of the unblurred image).
Alpha-based augmenters are intended for these use cases.
They either mix two images using a constant alpha factor or using a pixel-wise
mask.
Below image shows examples.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># First row</span>
<span class="n">iaa</span><span class="o">.</span><span class="n">Alpha</span><span class="p">(</span>
    <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
    <span class="n">first</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">MedianBlur</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="n">per_channel</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># Second row</span>
<span class="n">iaa</span><span class="o">.</span><span class="n">SimplexNoiseAlpha</span><span class="p">(</span>
    <span class="n">first</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">EdgeDetect</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span>
    <span class="n">per_channel</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="c1"># Third row</span>
<span class="n">iaa</span><span class="o">.</span><span class="n">SimplexNoiseAlpha</span><span class="p">(</span>
    <span class="n">first</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">EdgeDetect</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span>
    <span class="n">second</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">ContrastNormalization</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)),</span>
    <span class="n">per_channel</span><span class="o">=</span><span class="mf">0.5</span>
<span class="p">)</span>

<span class="c1"># Forth row</span>
<span class="n">iaa</span><span class="o">.</span><span class="n">FrequencyNoiseAlpha</span><span class="p">(</span>
    <span class="n">first</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">Affine</span><span class="p">(</span>
        <span class="n">rotate</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
        <span class="n">translate_px</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)}</span>
    <span class="p">),</span>
    <span class="n">second</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">AddToHueAndSaturation</span><span class="p">((</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">)),</span>
    <span class="n">per_channel</span><span class="o">=</span><span class="mf">0.5</span>
<span class="p">)</span>

<span class="c1"># Fifth row</span>
<span class="n">iaa</span><span class="o">.</span><span class="n">SimplexNoiseAlpha</span><span class="p">(</span>
    <span class="n">first</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">SimplexNoiseAlpha</span><span class="p">(</span>
        <span class="n">first</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">EdgeDetect</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">second</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">ContrastNormalization</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)),</span>
        <span class="n">per_channel</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">),</span>
    <span class="n">second</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">FrequencyNoiseAlpha</span><span class="p">(</span>
        <span class="n">exponent</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">first</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">Affine</span><span class="p">(</span>
            <span class="n">rotate</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
            <span class="n">translate_px</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)}</span>
        <span class="p">),</span>
        <span class="n">second</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">AddToHueAndSaturation</span><span class="p">((</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">)),</span>
        <span class="n">per_channel</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">),</span>
    <span class="n">per_channel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">aggregation_method</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span>
    <span class="n">sigmoid</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id1">
<img alt="Introduction example" src="../_images/introduction.jpg" />
<p class="caption"><span class="caption-text">Various effects of combining alpha-augmenters with other augmenters.
First row shows <cite>Alpha</cite> with <cite>MedianBlur</cite>,
second <cite>SimplexNoiseAlpha</cite> with <cite>EdgeDetect</cite>,
third <cite>SimplexNoiseAlpha</cite> with <cite>EdgeDetect</cite> and <cite>ContrastNormalization</cite>,
third shows <cite>FrequencyNoiseAlpha</cite> with <cite>Affine</cite> and <cite>AddToHueAndSaturation</cite>
and forth row shows a mixture <cite>SimplexNoiseAlpha</cite> and <cite>FrequencyNoiseAlpha</cite>.</span></p>
</div>
</div>
<div class="section" id="constant-alpha">
<h2>Constant Alpha<a class="headerlink" href="#constant-alpha" title="Permalink to this headline">¶</a></h2>
<p>The augmenter <cite>Alpha</cite> allows to mix the results of two image sources using
an alpha factor that is constant throughout the whole image, i.e. it follows
roughly <cite>I_blend = alpha * I_a + (1 - alpha) * I_b</cite> per image, where <cite>I_a</cite> is
the image from the first image source and <cite>I_b</cite> is the image from the second
image source.
Often, the first source will be an augmented version of the image and
the second source will be the original image, leading to a blend of augmented
and unaugmented image. The second image source can also be an augmented version
of the image, leading to a blend of two distinct augmentation effects.
Alpha is already built into some augmenters as a parameter, e.g. into <cite>EdgeDetect</cite>.</p>
<p>The below example code generates images that are a blend between <cite>Sharpen</cite>
and <cite>CoarseDropout</cite>. Notice how the sharpening does not affect the black
rectangles from dropout, as the two augmenters are both applied to the original
images and merely blended.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imgaug</span> <span class="k">as</span> <span class="nn">ia</span>
<span class="kn">from</span> <span class="nn">imgaug</span> <span class="k">import</span> <span class="n">augmenters</span> <span class="k">as</span> <span class="n">iaa</span>

<span class="n">ia</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Example batch of images.</span>
<span class="c1"># The array has shape (8, 128, 128, 3) and dtype uint8.</span>
<span class="n">images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span><span class="n">ia</span><span class="o">.</span><span class="n">quokka</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)],</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span>
<span class="p">)</span>

<span class="n">seq</span> <span class="o">=</span> <span class="n">iaa</span><span class="o">.</span><span class="n">Alpha</span><span class="p">(</span>
    <span class="n">factor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
    <span class="n">first</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">Sharpen</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">lightness</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">second</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">CoarseDropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">size_px</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">images_aug</span> <span class="o">=</span> <span class="n">seq</span><span class="o">.</span><span class="n">augment_images</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id2">
<img alt="Basic example for Alpha" src="../_images/alpha_constant_example_basic.jpg" />
<p class="caption"><span class="caption-text">Mixing Sharpen and CoarseDropout via Alpha - not the same as executing them one after the other.</span></p>
</div>
<p>Similar to other augmenters, <cite>Alpha</cite> supports a <cite>per_channel</cite> mode, in which it
samples overlay strengths for each channel independently. As a result, some
channels may show more from the first (or second) image source than other
channels. This can lead to visible color effects. The following example
is the same as the one above, only <cite>per_channel</cite> was activated.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">iaa</span><span class="o">.</span><span class="n">Alpha</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">per_channel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id3">
<img alt="Basic example for Alpha with per_channel=True" src="../_images/alpha_constant_example_per_channel.jpg" />
<p class="caption"><span class="caption-text">Mixing Sharpen and CoarseDropout via Alpha and per_channel set to True.</span></p>
</div>
<p>Alpha can also be used with augmenters that change the position of pixels,
leading to “ghost” images. (This should not be done when also augmenting
keypoints, as their position becomes unclear.)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">seq</span> <span class="o">=</span> <span class="n">iaa</span><span class="o">.</span><span class="n">Alpha</span><span class="p">(</span>
    <span class="n">factor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
    <span class="n">first</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">Affine</span><span class="p">(</span><span class="n">rotate</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)),</span>
    <span class="n">per_channel</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id4">
<img alt="Basic example for Alpha with Affine and per_channel=True" src="../_images/alpha_constant_example_affine.jpg" />
<p class="caption"><span class="caption-text">Mixing original images with their rotated version. Some channels are more visibly rotated than others.</span></p>
</div>
</div>
<div class="section" id="simplexnoisealpha">
<h2>SimplexNoiseAlpha<a class="headerlink" href="#simplexnoisealpha" title="Permalink to this headline">¶</a></h2>
<p><cite>Alpha</cite> uses a constant blending factor per image (or per channel). This limits
the possibilities. Often a more localized factor is desired to create unusual
patterns. <cite>SimplexNoiseAlpha</cite> is an augmenter that does that. It generates
continuous masks following simplex noise and uses them to perform local
blending. The following example shows a combination of <cite>SimplexNoiseAlpha</cite>
and <cite>Multiply</cite> (with <cite>per_channel=True</cite>) that creates blobs of various
colors in the image.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imgaug</span> <span class="k">as</span> <span class="nn">ia</span>
<span class="kn">from</span> <span class="nn">imgaug</span> <span class="k">import</span> <span class="n">augmenters</span> <span class="k">as</span> <span class="n">iaa</span>

<span class="n">ia</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Example batch of images.</span>
<span class="c1"># The array has shape (8, 128, 128, 3) and dtype uint8.</span>
<span class="n">images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span><span class="n">ia</span><span class="o">.</span><span class="n">quokka</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)],</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span>
<span class="p">)</span>

<span class="n">seq</span> <span class="o">=</span> <span class="n">iaa</span><span class="o">.</span><span class="n">SimplexNoiseAlpha</span><span class="p">(</span>
    <span class="n">first</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">Multiply</span><span class="p">(</span><span class="n">iap</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]),</span> <span class="n">per_channel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">images_aug</span> <span class="o">=</span> <span class="n">seq</span><span class="o">.</span><span class="n">augment_images</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id5">
<img alt="Basic example for SimplexNoiseAlpha" src="../_images/alpha_simplex_example_basic.jpg" />
<p class="caption"><span class="caption-text">Mixing original images with their versions modified by Multiply (with per_channel set to True).
Simplex noise masks are used for the blending process, leading to blobby patterns.</span></p>
</div>
<p><cite>SimplexNoiseAlpha</cite> also supports <cite>per_channel=True</cite>, leading to unique
noise masks sampled per channel. The following example shows the combination
of <cite>SimplexNoiseAlpha</cite> (with <cite>per_channel=True</cite>) and <cite>EdgeDetect</cite>.
Even though <cite>EdgeDetect</cite> usually generates black and white images (white=edges,
black=everything else), here the combination leads to strong color effects
as the channel-wise noise masks only blend EdgeDetect’s result for some
channels.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">seq</span> <span class="o">=</span> <span class="n">iaa</span><span class="o">.</span><span class="n">SimplexNoiseAlpha</span><span class="p">(</span>
    <span class="n">first</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">EdgeDetect</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span>
    <span class="n">per_channel</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id6">
<img alt="Basic example for SimplexNoiseAlpha with per_channel=True" src="../_images/alpha_simplex_example_per_channel.jpg" />
<p class="caption"><span class="caption-text">Blending images via simplex noise can lead to unexpected but diverse patterns
when per_channel is set to True. Here, a mixture of original images with
<cite>EdgeDetect(1.0)</cite> is used.</span></p>
</div>
<p><cite>SimplexNoiseAlpha</cite> uses continuous noise masks (2d arrays with values in the
range [0.0, 1.0]) to blend images. The below image shows examples of 64x64
noise masks generated by <cite>SimplexNoiseAlpha</cite> with default settings.
Values close to 1.0 (white) indicate that pixel colors will be taken from
the first image source, while 0.0 (black) values indicate that pixel colors
will be taken from the second image source. (Often only one image source will
be given in the form of augmenters and the second will fall back to the
original images fed into <cite>SimplexNoiseAlpha</cite>.)</p>
<div class="figure" id="id7">
<img alt="Examples of noise masks generated by SimplexNoiseAlpha" src="../_images/alpha_simplex_noise_masks.jpg" />
<p class="caption"><span class="caption-text">Examples of noise masks generated by SimplexNoiseAlpha using default settings.</span></p>
</div>
<p><cite>SimplexNoiseAlpha</cite> generates its noise masks in low resolution images and
then upscales the masks to the size of the input images. During upscaling it
usually uses nearest neighbour interpolation (<cite>nearest</cite>), linear
interpolation (<cite>linear</cite>) or cubic interpolation (<cite>cubic</cite>). Nearest neighbour
interpolation leads to noise maps with rectangular blobs. The below example
shows noise maps generated when only using nearest neighbour interpolation.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">seq</span> <span class="o">=</span> <span class="n">iaa</span><span class="o">.</span><span class="n">SimplexNoiseAlpha</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">upscale_method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id8">
<img alt="Examples of noise masks generated by SimplexNoiseAlpha with upscaling method nearest" src="../_images/alpha_simplex_noise_masks_nearest.jpg" />
<p class="caption"><span class="caption-text">Examples of noise masks generated by SimplexNoiseAlpha when restricting the upscaling method to <cite>nearest</cite>.</span></p>
</div>
<p>Similarly, the following example shows noise maps generated when only using
linear interpolation.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">seq</span> <span class="o">=</span> <span class="n">iaa</span><span class="o">.</span><span class="n">SimplexNoiseAlpha</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">upscale_method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id9">
<img alt="Examples of noise masks generated by SimplexNoiseAlpha with upscaling method linear" src="../_images/alpha_simplex_noise_masks_linear.jpg" />
<p class="caption"><span class="caption-text">Examples of noise masks generated by SimplexNoiseAlpha when restricting the upscaling method to <cite>linear</cite>.</span></p>
</div>
</div>
<div class="section" id="frequencynoisealpha">
<h2>FrequencyNoiseAlpha<a class="headerlink" href="#frequencynoisealpha" title="Permalink to this headline">¶</a></h2>
<p><cite>FrequencyNoiseAlpha</cite> is mostly identical to <cite>SimplexNoiseAlpha</cite>. In contrast
to <cite>SimplexNoiseAlpha</cite> it uses a different sampling process to generate
the noise maps. The process is based on starting with random frequencies,
weighting them with a random exponent and then transforming from frequency
domain to spatial domain. When using a low exponent value this leads to
large, smooth blobs. Slightly higher exponents lead to cloudy patterns.
High exponent values lead to recurring, small patterns. The below example
shows the usage of <cite>FrequencyNoiseAlpha</cite>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imgaug</span> <span class="k">as</span> <span class="nn">ia</span>
<span class="kn">from</span> <span class="nn">imgaug</span> <span class="k">import</span> <span class="n">augmenters</span> <span class="k">as</span> <span class="n">iaa</span>
<span class="kn">from</span> <span class="nn">imgaug</span> <span class="k">import</span> <span class="n">parameters</span> <span class="k">as</span> <span class="n">iap</span>

<span class="n">ia</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Example batch of images.</span>
<span class="c1"># The array has shape (8, 64, 64, 3) and dtype uint8.</span>
<span class="n">images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span><span class="n">ia</span><span class="o">.</span><span class="n">quokka</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)],</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span>
<span class="p">)</span>

<span class="n">seq</span> <span class="o">=</span> <span class="n">iaa</span><span class="o">.</span><span class="n">FrequencyNoiseAlpha</span><span class="p">(</span>
    <span class="n">first</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">Multiply</span><span class="p">(</span><span class="n">iap</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]),</span> <span class="n">per_channel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">images_aug</span> <span class="o">=</span> <span class="n">seq</span><span class="o">.</span><span class="n">augment_images</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id10">
<img alt="Basic example for FrequencyNoiseAlpha" src="../_images/alpha_frequency_example_basic.jpg" />
<p class="caption"><span class="caption-text">Mixing original images with their versions modified by Multiply (with per_channel set to True).
Simplex noise masks are used for the blending process, leading to blobby patterns.</span></p>
</div>
<p>Similarly to simplex noise, <cite>FrequencyNoiseAlpha</cite> also supports <cite>per_channel=True</cite>,
leading to different noise maps per image channel.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">seq</span> <span class="o">=</span> <span class="n">iaa</span><span class="o">.</span><span class="n">FrequencyNoiseAlpha</span><span class="p">(</span>
    <span class="n">first</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">EdgeDetect</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span>
    <span class="n">per_channel</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id11">
<img alt="Basic example for FrequencyNoiseAlpha with per_channel=True" src="../_images/alpha_frequency_example_per_channel.jpg" />
<p class="caption"><span class="caption-text">Blending images via frequency noise can lead to unexpected but diverse patterns
when per_channel is set to True. Here, a mixture of original images with
<cite>EdgeDetect(1.0)</cite> is used.</span></p>
</div>
<p>The below image shows random example noise masks generated by
<cite>FrequencyNoiseAlpha</cite> with default settings.</p>
<div class="figure" id="id12">
<img alt="Examples of noise masks generated by FrequencyNoiseAlpha" src="../_images/alpha_frequency_noise_masks.jpg" />
<p class="caption"><span class="caption-text">Examples of noise masks generated by FrequencyNoiseAlpha using default settings.</span></p>
</div>
<p>The following image shows the effects of varying <cite>exponent</cite> between <cite>-4.0</cite>
and <cite>4.0</cite>. To show these effects more clearly, a few features of
<cite>FrequencyNoiseAlpha</cite> were deactivated (e.g. multiple iterations). In the code,
<cite>E</cite> is the value of the exponent (e.g. <cite>E=-2.0</cite>).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">seq</span> <span class="o">=</span> <span class="n">iaa</span><span class="o">.</span><span class="n">FrequencyNoiseAlpha</span><span class="p">(</span>
    <span class="n">exponent</span><span class="o">=</span><span class="n">E</span><span class="p">,</span>
    <span class="n">first</span><span class="o">=</span><span class="n">iaa</span><span class="o">.</span><span class="n">Multiply</span><span class="p">(</span><span class="n">iap</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]),</span> <span class="n">per_channel</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">size_px_max</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
    <span class="n">upscale_method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">sigmoid</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id13">
<img alt="Examples of noise masks generated by FrequencyNoiseAlpha under varying exponents" src="../_images/alpha_frequency_noise_masks_exponents.jpg" />
<p class="caption"><span class="caption-text">Examples of noise masks generated by FrequencyNoiseAlpha using default settings with varying exponents.</span></p>
</div>
<p>Similarly to <cite>SimplexNoiseAlpha</cite>, <cite>FrequencyNoiseAlpha</cite> also generates the
noise masks as low resolution versions and then upscales them to the full
image size. The following images show the usage of nearest neighbour
interpolation (<cite>upscale_method=”nearest”</cite>) and linear interpolation
(<cite>upscale_method=”linear”</cite>).</p>
<div class="figure" id="id14">
<img alt="Examples of noise masks generated by FrequencyNoiseAlpha with upscaling method nearest" src="../_images/alpha_frequency_noise_masks_nearest.jpg" />
<p class="caption"><span class="caption-text">Examples of noise masks generated by FrequencyNoiseAlpha when restricting the upscaling method to <cite>nearest</cite>.</span></p>
</div>
<div class="figure" id="id15">
<img alt="Examples of noise masks generated by FrequencyNoiseAlpha with upscaling method linear" src="../_images/alpha_frequency_noise_masks_linear.jpg" />
<p class="caption"><span class="caption-text">Examples of noise masks generated by FrequencyNoiseAlpha when restricting the upscaling method to <cite>linear</cite>.</span></p>
</div>
</div>
<div class="section" id="iterativenoiseaggregator">
<h2>IterativeNoiseAggregator<a class="headerlink" href="#iterativenoiseaggregator" title="Permalink to this headline">¶</a></h2>
<p>Both <cite>SimplexNoiseAlpha</cite> and <cite>FrequencyNoiseAlpha</cite> wrap around
<cite>IterativeNoiseAggregator</cite>, a component to generate noise masks in multiple
iterations. It has parameters for the number of iterations (1 to N)
and for the aggregation methods, which controls how the noise masks from
the different iterations are to be combined. Valid aggregation methods are
<cite>“min”</cite>, <cite>“avg”</cite> and <cite>“max”</cite>, where <cite>min</cite> takes the minimum over all
iteration’s masks, <cite>max</cite> the maxmimum and <cite>avg</cite> the average. As a result,
masks generated with method <cite>min</cite> tend to be close to 0.0 (mostly black values),
those generated with <cite>max</cite> close to 1.0 and <cite>avg</cite> converges towards 0.5.
(0.0 means that the results of the second image dominate the final image, so
in many cases the original images before the augmenter). The following
image shows the effects of changing the number of iterations when
combining <cite>FrequencyNoise</cite> with <cite>IterativeNoiseAggregator</cite>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># This is how the iterations would be changed for FrequencyNoiseAlpha.</span>
<span class="c1"># (Same for `SimplexNoiseAlpha`.)</span>
<span class="n">seq</span> <span class="o">=</span> <span class="n">iaa</span><span class="o">.</span><span class="n">FrequencyNoiseAlpha</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">iterations</span><span class="o">=</span><span class="n">N</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id16">
<img alt="Examples of varying the number of iterations in IterativeNoiseAggregator" src="../_images/iterative_vary_iterations.jpg" />
<p class="caption"><span class="caption-text">Examples of varying the number of iterations in IterativeNoiseAggregator (here in combination with FrequencyNoise).</span></p>
</div>
<p>The following image shows the effects of changing the aggregation mode
(with varying iterations).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># This is how the iterations and aggregation method would be changed for</span>
<span class="c1"># FrequencyNoiseAlpha. (Same for `SimplexNoiseAlpha`.)</span>
<span class="n">seq</span> <span class="o">=</span> <span class="n">iaa</span><span class="o">.</span><span class="n">FrequencyNoiseAlpha</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">iterations</span><span class="o">=</span><span class="n">N</span><span class="p">,</span>
    <span class="n">aggregation_method</span><span class="o">=</span><span class="n">M</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id17">
<img alt="Examples of varying the methods and iterations in IterativeNoiseAggregator" src="../_images/iterative_vary_methods.jpg" />
<p class="caption"><span class="caption-text">Examples of varying the methods and iterations in IterativeNoiseAggregator (here in combination with FrequencyNoise).</span></p>
</div>
</div>
<div class="section" id="sigmoid">
<h2>Sigmoid<a class="headerlink" href="#sigmoid" title="Permalink to this headline">¶</a></h2>
<p>Generated noise masks can often end up having many values around 0.5,
especially when running <cite>IterativeNoiseAggregator</cite> with many iterations
and aggregation method <cite>avg</cite>. This can be undesired. <cite>Sigmoid</cite> is a
method to compensate that. It applies a sigmoid function to the noise masks,
forcing the values to mostly lie close to 0.0 or 1.0 and only rarely in
between. This can lead to blobs of values close to 1.0 (“use only colors from
images coming from source A”), surrounded by blobs with values close to
0.0 (“use only colors from images coming from source B”). This is similar
to taking <em>either</em> from one image source (per pixel) or the other, but
usually not both. Sigmoid is integrated into both <cite>SimplexNoiseAlpha</cite>
and <cite>FrequencyNoiseAlpha</cite>. It can be dynamically activated/deactivated
and has a threshold parameter that controls how aggressive and pushes the
noise values towards 1.0.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># This is how the Sigmoid would be activated/deactivated for</span>
<span class="c1"># FrequencyNoiseAlpha (same for SimplexNoiseAlpha). P is the probability</span>
<span class="c1"># of the Sigmoid being activated (can be True/False), T is the</span>
<span class="c1"># threshold (sane values are usually around -10 to +10, can be a</span>
<span class="c1"># tuple, e.g. sigmoid_thresh=(-10, 10), to indicate a uniform range).</span>
<span class="n">seq</span> <span class="o">=</span> <span class="n">iaa</span><span class="o">.</span><span class="n">FrequencyNoiseAlpha</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">sigmoid</span><span class="o">=</span><span class="n">P</span><span class="p">,</span>
    <span class="n">sigmoid_thresh</span><span class="o">=</span><span class="n">T</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The below image shows the effects of applying
Sigmoid to noise masks generated by <cite>FrequencyNoise</cite>.</p>
<div class="figure" id="id18">
<img alt="Examples of noise maps without and with activated Sigmoid" src="../_images/sigmoid_vary_activated.jpg" />
<p class="caption"><span class="caption-text">Examples of noise maps without and with activated Sigmoid (noise maps here from FrequencyNoise).</span></p>
</div>
<p>The below image shows the effects of varying the sigmoid’s threshold.
Lower values place the threshold further to the “left” (lower x values),
leading to more x-values being above the threshold values, leading to
more 1.0s in the noise masks.</p>
<div class="figure" id="id19">
<img alt="Examples of varying the Sigmoid threshold" src="../_images/sigmoid_vary_threshold.jpg" />
<p class="caption"><span class="caption-text">Examples of varying the Sigmoid threshold from -10.0 to 10.0.</span></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="augmenters.html" class="btn btn-neutral float-right" title="Overview of Augmenters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="parameters.html" class="btn btn-neutral" title="Stochastic Parameters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Alexander Jung.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.2.6',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>