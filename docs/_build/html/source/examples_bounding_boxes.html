

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Examples: Bounding Boxes &mdash; imgaug 0.2.6 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Stochastic Parameters" href="parameters.html" />
    <link rel="prev" title="Examples: Keypoints" href="examples_keypoints.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> imgaug
          

          
          </a>

          
            
            
              <div class="version">
                0.2.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples_basics.html">Examples: Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples_keypoints.html">Examples: Keypoints</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples: Bounding Boxes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#a-simple-example">A simple example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dealing-with-bounding-boxes-outside-of-the-image">Dealing with bounding boxes outside of the image</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shifting-moving-bounding-boxes">Shifting/Moving Bounding Boxes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#projection-of-bbs-onto-rescaled-images">Projection of BBs Onto Rescaled Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#computing-intersections-unions-and-ious">Computing Intersections, Unions and IoUs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Stochastic Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="alpha.html">Blending/Overlaying images</a></li>
<li class="toctree-l1"><a class="reference internal" href="augmenters.html">Overview of Augmenters</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">imgaug</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">imgaug</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Examples: Bounding Boxes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/source/examples_bounding_boxes.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="examples-bounding-boxes">
<h1>Examples: Bounding Boxes<a class="headerlink" href="#examples-bounding-boxes" title="Permalink to this headline">¶</a></h1>
<p><cite>imgaug</cite> offers support for bounding boxes (aka rectangles, regions of interest).
E.g. if an image is rotated during augmentation, the library can also rotate
all bounding boxes on it correspondingly.</p>
<p>Features of the library’s bounding box support:</p>
<blockquote>
<div><ul class="simple">
<li>Represent bounding boxes as objects (<cite>imgaug.BoundingBox</cite>).</li>
<li>Augment bounding boxes.</li>
<li>Draw bounding boxes on images.</li>
<li>Move/shift bounding boxes on images,
project them onto other images (e.g. onto the same image after resizing),
compute their intersections/unions and IoU values.</li>
</ul>
</div></blockquote>
<div class="section" id="a-simple-example">
<h2>A simple example<a class="headerlink" href="#a-simple-example" title="Permalink to this headline">¶</a></h2>
<p>The following example loads an image and places two bounding boxes on it.
The image is then augmented to be brighter, slightly rotated and scaled.
These augmentations are also applied to the bounding boxes.
The image is then shown before and after augmentation (with bounding boxes
drawn on it).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imgaug</span> <span class="k">as</span> <span class="nn">ia</span>
<span class="kn">from</span> <span class="nn">imgaug</span> <span class="k">import</span> <span class="n">augmenters</span> <span class="k">as</span> <span class="n">iaa</span>

<span class="n">ia</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">quokka</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>
<span class="n">bbs</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">BoundingBoxesOnImage</span><span class="p">([</span>
    <span class="n">ia</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="mi">150</span><span class="p">),</span>
    <span class="n">ia</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="mi">130</span><span class="p">)</span>
<span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">seq</span> <span class="o">=</span> <span class="n">iaa</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">iaa</span><span class="o">.</span><span class="n">Multiply</span><span class="p">((</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)),</span> <span class="c1"># change brightness, doesn&#39;t affect BBs</span>
    <span class="n">iaa</span><span class="o">.</span><span class="n">Affine</span><span class="p">(</span>
        <span class="n">translate_px</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">},</span>
        <span class="n">scale</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
    <span class="p">)</span> <span class="c1"># translate by 40/60px on x/y axis, and scale to 50-70%, affects BBs</span>
<span class="p">])</span>

<span class="c1"># Make our sequence deterministic.</span>
<span class="c1"># We can now apply it to the image and then to the BBs and it will</span>
<span class="c1"># lead to the same augmentations.</span>
<span class="c1"># IMPORTANT: Call this once PER BATCH, otherwise you will always get the</span>
<span class="c1"># exactly same augmentations for every batch!</span>
<span class="n">seq_det</span> <span class="o">=</span> <span class="n">seq</span><span class="o">.</span><span class="n">to_deterministic</span><span class="p">()</span>

<span class="c1"># Augment BBs and images.</span>
<span class="c1"># As we only have one image and list of BBs, we use</span>
<span class="c1"># [image] and [bbs] to turn both into lists (batches) for the</span>
<span class="c1"># functions and then [0] to reverse that. In a real experiment, your</span>
<span class="c1"># variables would likely already be lists.</span>
<span class="n">image_aug</span> <span class="o">=</span> <span class="n">seq_det</span><span class="o">.</span><span class="n">augment_images</span><span class="p">([</span><span class="n">image</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">bbs_aug</span> <span class="o">=</span> <span class="n">seq_det</span><span class="o">.</span><span class="n">augment_bounding_boxes</span><span class="p">([</span><span class="n">bbs</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># print coordinates before/after augmentation (see below)</span>
<span class="c1"># use .x1_int, .y_int, ... to get integer coordinates</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bbs</span><span class="o">.</span><span class="n">bounding_boxes</span><span class="p">)):</span>
    <span class="n">before</span> <span class="o">=</span> <span class="n">bbs</span><span class="o">.</span><span class="n">bounding_boxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">after</span> <span class="o">=</span> <span class="n">bbs_aug</span><span class="o">.</span><span class="n">bounding_boxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BB </span><span class="si">%d</span><span class="s2">: (</span><span class="si">%.4f</span><span class="s2">, </span><span class="si">%.4f</span><span class="s2">, </span><span class="si">%.4f</span><span class="s2">, </span><span class="si">%.4f</span><span class="s2">) -&gt; (</span><span class="si">%.4f</span><span class="s2">, </span><span class="si">%.4f</span><span class="s2">, </span><span class="si">%.4f</span><span class="s2">, </span><span class="si">%.4f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">i</span><span class="p">,</span>
        <span class="n">before</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="n">before</span><span class="o">.</span><span class="n">y1</span><span class="p">,</span> <span class="n">before</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="n">before</span><span class="o">.</span><span class="n">y2</span><span class="p">,</span>
        <span class="n">after</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="n">after</span><span class="o">.</span><span class="n">y1</span><span class="p">,</span> <span class="n">after</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="n">after</span><span class="o">.</span><span class="n">y2</span><span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># image with BBs before/after augmentation (shown below)</span>
<span class="n">image_before</span> <span class="o">=</span> <span class="n">bbs</span><span class="o">.</span><span class="n">draw_on_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">image_after</span> <span class="o">=</span> <span class="n">bbs_aug</span><span class="o">.</span><span class="n">draw_on_image</span><span class="p">(</span><span class="n">image_aug</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">])</span>
</pre></div>
</div>
<p>Console output of the example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">BB</span> <span class="mi">0</span><span class="p">:</span> <span class="p">(</span><span class="mf">65.0000</span><span class="p">,</span> <span class="mf">100.0000</span><span class="p">,</span> <span class="mf">200.0000</span><span class="p">,</span> <span class="mf">150.0000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="mf">130.7524</span><span class="p">,</span> <span class="mf">171.3311</span><span class="p">,</span> <span class="mf">210.1272</span><span class="p">,</span> <span class="mf">200.7291</span><span class="p">)</span>
<span class="n">BB</span> <span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="mf">150.0000</span><span class="p">,</span> <span class="mf">80.0000</span><span class="p">,</span> <span class="mf">200.0000</span><span class="p">,</span> <span class="mf">130.0000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="mf">180.7291</span><span class="p">,</span> <span class="mf">159.5718</span><span class="p">,</span> <span class="mf">210.1272</span><span class="p">,</span> <span class="mf">188.9699</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id1">
<img alt="Simple bounding box augmentation example" src="../_images/simple1.jpg" />
<p class="caption"><span class="caption-text">Image with bounding boxes, before (left) and after (right)
augmentation. Bounding boxes are shown in green (before augmentation) and
blue (after augmentation).</span></p>
</div>
<p>Note that the bounding box augmentation works by augmenting each box’s edge
coordinates and then drawing a bounding box around these augmented
coordinates. Each of these new bounding boxes is therefore axis-aligned.
This can sometimes lead to oversized new bounding boxes,
especially in the case of rotation. The following image shows the result
of the same code as in the example above, but <cite>Affine</cite> was replaced by
<cite>Affine(rotate=45)</cite>:</p>
<div class="figure" id="id2">
<img alt="Bounding box augmentation with rotation" src="../_images/rotation.jpg" />
<p class="caption"><span class="caption-text">Image with bounding boxes, before (left) and after (right)
augmentation. The image was augmentated by rotating it by 45 degrees.
The axis-aligned bounding box around the augmented keypoints ends up
being oversized.</span></p>
</div>
</div>
<div class="section" id="dealing-with-bounding-boxes-outside-of-the-image">
<h2>Dealing with bounding boxes outside of the image<a class="headerlink" href="#dealing-with-bounding-boxes-outside-of-the-image" title="Permalink to this headline">¶</a></h2>
<p>When augmenting images and their respective bounding boxes, the boxes
can end up fully or partially outside of the image plane. By default, the
library still returns these boxes, even though that may not be desired.
The following example shows how to (a) remove bounding boxes that are
fully/partially outside of the image and (b) how to cut bounding boxes that
are partially outside of the image so that their are fully inside.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imgaug</span> <span class="k">as</span> <span class="nn">ia</span>
<span class="kn">from</span> <span class="nn">imgaug</span> <span class="k">import</span> <span class="n">augmenters</span> <span class="k">as</span> <span class="n">iaa</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">ia</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">GREEN</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">ORANGE</span> <span class="o">=</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">RED</span> <span class="o">=</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

<span class="c1"># Pad image with a 1px white and (BY-1)px black border</span>
<span class="k">def</span> <span class="nf">pad</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">by</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">by</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">image</span>
    <span class="n">image_border1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">255</span>
    <span class="p">)</span>
    <span class="n">image_border2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
        <span class="n">image_border1</span><span class="p">,</span> <span class="p">((</span><span class="n">by</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">by</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">by</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">by</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">image_border2</span>

<span class="c1"># Draw BBs on an image</span>
<span class="c1"># and before doing that, extend the image plane by BORDER pixels.</span>
<span class="c1"># Mark BBs inside the image plane with green color, those partially inside</span>
<span class="c1"># with orange and those fully outside with red.</span>
<span class="k">def</span> <span class="nf">draw_bbs</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">bbs</span><span class="p">,</span> <span class="n">border</span><span class="p">):</span>
    <span class="n">image_border</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">border</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">bb</span> <span class="ow">in</span> <span class="n">bbs</span><span class="o">.</span><span class="n">bounding_boxes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bb</span><span class="o">.</span><span class="n">is_fully_within_image</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">GREEN</span>
        <span class="k">elif</span> <span class="n">bb</span><span class="o">.</span><span class="n">is_partly_within_image</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">ORANGE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">RED</span>
        <span class="n">image_border</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">border</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">border</span><span class="p">)</span>\
                         <span class="o">.</span><span class="n">draw_on_image</span><span class="p">(</span><span class="n">image_border</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">image_border</span>

<span class="c1"># Define example image with three small square BBs next to each other.</span>
<span class="c1"># Augment these BBs by shifting them to the right.</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">quokka</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>
<span class="n">bbs</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">BoundingBoxesOnImage</span><span class="p">([</span>
    <span class="n">ia</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="mi">75</span><span class="p">),</span>
    <span class="n">ia</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="mi">75</span><span class="p">),</span>
    <span class="n">ia</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="mi">175</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="mi">225</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">seq</span> <span class="o">=</span> <span class="n">iaa</span><span class="o">.</span><span class="n">Affine</span><span class="p">(</span><span class="n">translate_px</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">120</span><span class="p">})</span>
<span class="n">seq_det</span> <span class="o">=</span> <span class="n">seq</span><span class="o">.</span><span class="n">to_deterministic</span><span class="p">()</span>

<span class="n">image_aug</span> <span class="o">=</span> <span class="n">seq_det</span><span class="o">.</span><span class="n">augment_images</span><span class="p">([</span><span class="n">image</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">bbs_aug</span> <span class="o">=</span> <span class="n">seq_det</span><span class="o">.</span><span class="n">augment_bounding_boxes</span><span class="p">([</span><span class="n">bbs</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Draw the BBs (a) in their original form, (b) after augmentation,</span>
<span class="c1"># (c) after augmentation and removing those fully outside the image,</span>
<span class="c1"># (d) after augmentation and removing those fully outside the image and</span>
<span class="c1"># cutting those partially inside the image so that they are fully inside.</span>
<span class="n">image_before</span> <span class="o">=</span> <span class="n">draw_bbs</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">bbs</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">image_after1</span> <span class="o">=</span> <span class="n">draw_bbs</span><span class="p">(</span><span class="n">image_aug</span><span class="p">,</span> <span class="n">bbs_aug</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">image_after2</span> <span class="o">=</span> <span class="n">draw_bbs</span><span class="p">(</span><span class="n">image_aug</span><span class="p">,</span> <span class="n">bbs_aug</span><span class="o">.</span><span class="n">remove_out_of_image</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">image_after3</span> <span class="o">=</span> <span class="n">draw_bbs</span><span class="p">(</span><span class="n">image_aug</span><span class="p">,</span> <span class="n">bbs_aug</span><span class="o">.</span><span class="n">remove_out_of_image</span><span class="p">()</span><span class="o">.</span><span class="n">cut_out_of_image</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id3">
<img alt="Bounding box augmentation with OOIs" src="../_images/ooi.jpg" />
<p class="caption"><span class="caption-text">Results of the above example code. Top left: Original/unaugmented image
with bounding boxes (here visualized with an additional black border
around the image). Right, top: Image after augmentation (translation
120px to the right). One bounding box is now fully outside of the image area
(red), one is partially outside of it (orange). Right, middle: After using
<cite>.remove_out_of_image()</cite> the BB that was fully outside of the image area
was removed. Right, center: After using <cite>.remove_out_of_image()</cite> and
<cite>.cut_out_of_image()</cite>, one BB was removed and the one partially outside of
of image area was cut to be fully inside it.</span></p>
</div>
</div>
<div class="section" id="shifting-moving-bounding-boxes">
<h2>Shifting/Moving Bounding Boxes<a class="headerlink" href="#shifting-moving-bounding-boxes" title="Permalink to this headline">¶</a></h2>
<p>The function <cite>shift(top=&lt;int&gt;, right=&lt;int&gt;, bottom=&lt;int&gt;, left=&lt;int&gt;)</cite> can be
used to change the x/y position of all or specific bounding boxes.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imgaug</span> <span class="k">as</span> <span class="nn">ia</span>
<span class="kn">from</span> <span class="nn">imgaug</span> <span class="k">import</span> <span class="n">augmenters</span> <span class="k">as</span> <span class="n">iaa</span>

<span class="n">ia</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Define image and two bounding boxes</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">quokka</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>
<span class="n">bbs</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">BoundingBoxesOnImage</span><span class="p">([</span>
    <span class="n">ia</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="mi">75</span><span class="p">),</span>
    <span class="n">ia</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Move both BBs 25px to the right and the second BB 25px down</span>
<span class="n">bbs_shifted</span> <span class="o">=</span> <span class="n">bbs</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">bbs_shifted</span><span class="o">.</span><span class="n">bounding_boxes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bbs_shifted</span><span class="o">.</span><span class="n">bounding_boxes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>

<span class="c1"># Draw images before/after moving BBs</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">bbs</span><span class="o">.</span><span class="n">draw_on_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">bbs_shifted</span><span class="o">.</span><span class="n">draw_on_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id4">
<img alt="Shifting bounding boxes around" src="../_images/shift.jpg" />
<p class="caption"><span class="caption-text">Using <cite>shift()</cite> to move bounding boxes around (green: original BBs, blue: shifted/moved BBs).</span></p>
</div>
</div>
<div class="section" id="projection-of-bbs-onto-rescaled-images">
<h2>Projection of BBs Onto Rescaled Images<a class="headerlink" href="#projection-of-bbs-onto-rescaled-images" title="Permalink to this headline">¶</a></h2>
<p>Bounding boxes can easily be projected onto rescaled versions of the same
image using the function <cite>.on(image)</cite>. This changes the coordinates of the
bounding boxes. E.g. if the top left coordinate of the bounding box was before
at x=10% and y=15%, it will still be at x/y 10%/15% on the new image, though
the absolute pixel values will change depending on the height/width of the new
image.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imgaug</span> <span class="k">as</span> <span class="nn">ia</span>
<span class="kn">from</span> <span class="nn">imgaug</span> <span class="k">import</span> <span class="n">augmenters</span> <span class="k">as</span> <span class="n">iaa</span>

<span class="n">ia</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Define image with two bounding boxes</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">quokka</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>
<span class="n">bbs</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">BoundingBoxesOnImage</span><span class="p">([</span>
    <span class="n">ia</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="mi">75</span><span class="p">),</span>
    <span class="n">ia</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Rescale image and bounding boxes</span>
<span class="n">image_rescaled</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">imresize_single_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">))</span>
<span class="n">bbs_rescaled</span> <span class="o">=</span> <span class="n">bbs</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">image_rescaled</span><span class="p">)</span>

<span class="c1"># Draw image before/after rescaling and with rescaled bounding boxes</span>
<span class="n">image_bbs</span> <span class="o">=</span> <span class="n">bbs</span><span class="o">.</span><span class="n">draw_on_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">image_rescaled_bbs</span> <span class="o">=</span> <span class="n">bbs_rescaled</span><span class="o">.</span><span class="n">draw_on_image</span><span class="p">(</span><span class="n">image_rescaled</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id5">
<img alt="Projecting bounding boxes" src="../_images/projection.jpg" />
<p class="caption"><span class="caption-text">Using <cite>on()</cite> to project bounding boxes from one image to the other,
here onto an image of 2x the original size. New coordinates are determined
based on their relative positions on the old image.</span></p>
</div>
</div>
<div class="section" id="computing-intersections-unions-and-ious">
<h2>Computing Intersections, Unions and IoUs<a class="headerlink" href="#computing-intersections-unions-and-ious" title="Permalink to this headline">¶</a></h2>
<p>Computing intersections, unions and especially IoU values (intersection over union)
is common for many machine learning experiments. The library offers easy
functions for that.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imgaug</span> <span class="k">as</span> <span class="nn">ia</span>
<span class="kn">from</span> <span class="nn">imgaug</span> <span class="k">import</span> <span class="n">augmenters</span> <span class="k">as</span> <span class="n">iaa</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">ia</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Define image with two bounding boxes.</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">quokka</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>
<span class="n">bb1</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">bb2</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="mi">125</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Compute intersection, union and IoU value</span>
<span class="c1"># Intersection and union are both bounding boxes. They are here</span>
<span class="c1"># decreased/increased in size purely for better visualization.</span>
<span class="n">bb_inters</span> <span class="o">=</span> <span class="n">bb1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">bb2</span><span class="p">)</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">all_sides</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">bb_union</span> <span class="o">=</span> <span class="n">bb1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">bb2</span><span class="p">)</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">all_sides</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">iou</span> <span class="o">=</span> <span class="n">bb1</span><span class="o">.</span><span class="n">iou</span><span class="p">(</span><span class="n">bb2</span><span class="p">)</span>

<span class="c1"># Draw bounding boxes, intersection, union and IoU value on image.</span>
<span class="n">image_bbs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">image_bbs</span> <span class="o">=</span> <span class="n">bb1</span><span class="o">.</span><span class="n">draw_on_image</span><span class="p">(</span><span class="n">image_bbs</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">image_bbs</span> <span class="o">=</span> <span class="n">bb2</span><span class="o">.</span><span class="n">draw_on_image</span><span class="p">(</span><span class="n">image_bbs</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">image_bbs</span> <span class="o">=</span> <span class="n">bb_inters</span><span class="o">.</span><span class="n">draw_on_image</span><span class="p">(</span><span class="n">image_bbs</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">image_bbs</span> <span class="o">=</span> <span class="n">bb_union</span><span class="o">.</span><span class="n">draw_on_image</span><span class="p">(</span><span class="n">image_bbs</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">])</span>
<span class="n">image_bbs</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">draw_text</span><span class="p">(</span>
    <span class="n">image_bbs</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;IoU=</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">iou</span><span class="p">,),</span>
    <span class="n">x</span><span class="o">=</span><span class="n">bb_union</span><span class="o">.</span><span class="n">x2</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">bb_union</span><span class="o">.</span><span class="n">y1</span><span class="o">+</span><span class="n">bb_union</span><span class="o">.</span><span class="n">height</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id6">
<img alt="Computing intersections, unions and IoUs" src="../_images/iou.jpg" />
<p class="caption"><span class="caption-text">Two bounding boxes on an image (green), their intersection (red, slightly shrunk),
their union (blue, slightly extended) and their IoU value (white).</span></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="parameters.html" class="btn btn-neutral float-right" title="Stochastic Parameters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="examples_keypoints.html" class="btn btn-neutral" title="Examples: Keypoints" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Alexander Jung.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.2.6',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>