# 数据增强

# augmentation.augmentation


```python
augmentation.augmentation(
    path,
    shape,
    agmt_time,
    data_gen_args)
```

在训练前对样本集进行数据增强。函数保证每张图片的增广倍数都相同，并且会根据__path__目录中的所有子目录，创建带有___agmt__后缀的目录。增强的数据将会保存在对应的___agmt__目录内。需要目录的具体格式可以参见[数据预处理](数据预处理)。

- __参数__:
    - __path__: 字符串。数据所在文件夹地址，目录结尾一定要加“/”。每个类应该包含一个子目录。任何在子目录下的 jpg图像，都将被包含在生成器中。
    - __shape__: 整数元组 `(height, width, channels)`，默认:`(224, 224 3)`。所有的图像将被调整到的尺寸。
    - __agmt_time__: 整形数。数据增广倍数。
    - __data_gen_args__: 字典。提供的数据增强方法。选择使用的方法将依次叠加进行处理。对于指定参数的方法，如果为`rotation_range=30`，在实际运算时，具体参数将在`0-30`之间随机选取。
      - **samplewise_center**: 布尔值。将每个样本的均值设置为 0。

      - **samplewise_std_normalization**: 布尔值。将每个输入除以其标准差。

      - **zca_epsilon**: ZCA 白化的 epsilon 值，默认为 1e-6。

      - **zca_whitening**: 布尔值。应用 ZCA 白化。

      - **rotation_range**: 整形数。随机旋转的度数范围。

      - **width_shift_range**: 浮点数（总宽度的比例）。随机水平移动的范围。

      - **height_shift_range**: 浮点数（总高度的比例）。随机垂直移动的范围。

      - **shear_range**: 浮点数。剪切强度（以弧度逆时针方向剪切角度）。

      - **zoom_range**: 浮点数或[lower, upper]。随机缩放范围。如果是浮点数，`[lower, upper] = [1-zoom_range, 1+zoom_range]`。

      - **channel_shift_range**: 浮点数。随机通道转换的范围。

      - **fill_mode**: {"constant", "nearest", "reflect" or "wrap"} 之一。输入边界以外的点根据给定的模式填充：
        - "constant": `kkkkkkkk|abcd|kkkkkkkk` (`cval=k`)
        - "nearest": `aaaaaaaa|abcd|dddddddd`
        - "reflect": `abcddcba|abcd|dcbaabcd`
        - "wrap": `abcdabcd|abcd|abcdabcd`

      - **cval**: 浮点数或整数。用于边界之外的点的值，当 `fill_mode = "constant"` 时。

      - **horizontal_flip**: 布尔值。随机水平翻转。

      - **vertical_flip**: 布尔值。随机垂直翻转。

      - **rescale**: 重缩放因子。默认为 None。如果是 None 或 0，不进行缩放，否则将数据乘以所提供的值（在应用任何其他转换之前）。

      - **preprocessing_function**: 应用于每个输入的函数。这个函数会在任何其他改变之前运行。这个函数需要一个参数：一张图像（秩为 3 的 Numpy 张量），并且应该输出一个同尺寸的 Numpy 张量。例如

        ```python
        def noise(image):
            height, width = image.shape[:2]
            for i in range(int(0.0005*height*width)):
                x = np.random.randint(0, height)
                y = np.random.randint(0, width)
                image[x, y, :] = 255
            return image
        ```

- __返回__:

    数据的类别信息，如dogs。一级目录下的图像文件代表对应类别的样本，如dog001是dogs类的样本。代码将直接从样本对应的路径读取从属类别以及类别名称。为了保证后续内存中的样本可以和文件中的样本一一对应，最好确保每个样本拥有不同名称。

    ```python
    dataset/
        dogs/
            dog001.jpg
            dog002.jpg
            ...
        dogs_agmt/
            dog001_0_XXXX.jpg
            dog002_0_XXXX.jpg
            ...
        cats/
            cat001.jpg
            cat002.jpg
            ...
        cats_agmt/
            cat001_0_XXXX.jpg
            cat002_0_XXXX.jpg
            ...        
        ...
    ```



- __范例__:

  对指定目录下的图像进行数据增强。增强方法包括旋转、平移、剪切变换、缩放、颜色抖动，水平翻转。

  ```
  path_origin = 'dataset/'
  agument_time = 2
  new_shape = (224, 224, 3)
  data_gen_args = dict(
      rotation_range=30.,
      width_shift_range=0.1,
      height_shift_range=0.1,
      shear_range=0.75,
      zoom_range=0.05,
      channel_shift_range=10.,
      horizontal_flip=True)

  agmt.augmentation(path_origin, agument_time, new_shape, data_gen_args)
  ```

