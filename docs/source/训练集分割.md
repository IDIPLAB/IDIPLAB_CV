# 训练集分割

##  database_IO.load_all_data

```python
database_IO.load_all_data(
    path_orig, 
    icld_agmt=False)
```

读取**path_orig**目录内的图片，将其作为原始数据集。代码将直接从样本对应的路径读取从属类别以及类别名称。可以调整**icld_agmt**参数来选择是否读取增强后的数据（如果存在的话）。为了保证代码的顺利运行，请保证**path_orig**目录下的文件按照[规范](数据预处理)放置。

- __参数__:
    - __path_orig__: 字符串。数据所在文件夹地址，目录结尾一定要加“/”。
    - __icld_agmt__: 布尔值，默认为**False**。是否读取增强数据。如果是 None 或 0，不读取增强后的图像，即文件夹名以`_agmt`作为后缀的数据。
- __返回__:
    - __imgs_orig__: 列表。原始图片集，长为 `(samples)`，每个元素是尺寸为`(height, width, channels)`的图像。
    - __imgs_name_orig__: 列表。原始图片名集，长为 `(samples)`，每个元素是样本名字符串。
    - __labels_orig__: 列表。原始图片名集，长为 `(samples)`，每个元素是分类名字符串。
    - __imgs_agmt__: 列表。增强图片集，长为 `(augmented samples)`，每个元素是尺寸为`(height, width, channels)`的图像。
    - __imgs_name_agmt__: 列表。增强图片集，长为`(augmented samples)`，每个元素是样本名字符串。
    - __labels_agmt__: 列表。增强图片集，长为`(augmented samples)`，每个元素是分类名字符串。
    - __classes__: 字典。分类名称，长为 `(classed)`。类的列表将自动从“目录”下的子目录名称/结构中推断出来，其中每个子目录都将被作为不同的类（类名将按字典序映射到标签的索引），如`'dogs': 0`。


- __范例__:

  图像存放在`../data/set/`目录下，读取包括增强数据的所有图像。

  ```python
  path_orig = "../data/set/"
  icld_agmt = True

  imgs_orig, _, labels_orig, imgs_agmt, _, labels_agmt, classes = load_all_data(
      path_orig, 
      icld_agmt)
  ```
  运行成功时会得到以下结果。

  ```python
  --->开始读取
  读取耗时: 10.17204314799486 s
  样本尺寸: (224, 224, 3)
  原样本数: 486  增强样本数: 9711
  类别: {'C1': 0, 'C2': 1, 'C3': 2, 'C4': 3, 'C5': 4, 'N1': 5, 'N2': 6, 'N3': 7, 'N4': 8, 'N5': 9, 'N6': 10, 'P1': 11, 'P2': 12, 'P3': 13, 'P4': 14, 'P5': 15}
  ```




***
## database_IO.train_test_split

```python
database_IO.train_test_split(
    imgs_orig,
    labels_orig,
    imgs_agmt,
    labels_agmt,
    all_splits=3,
    now_splits=1,
    icld_agmt=False)
```

将原始数据集按照交叉检验的方式分割为训练集和测试集。可以通过调整**all_splits**和**now_splits**来设置交叉检验的折数和轮次。算法尽量促使训练集中每一类的比例是相同的，但如果某一类中样本数不足以分割时会出现空训练集的情况:cold_sweat:。可以调整**icld_agmt**参数来选择是否对训练集读取增强后对应的数据（如果存在的话）。

- __参数__:
    - __imgs_orig__: 列表。原始图片集，长为 `(samples)`，每个元素是尺寸为`(height, width, channels)`的图像。
    - __labels_orig__: 列表。原始图片名集，长为 `(samples)`，每个元素是分类名字符串。
    - __imgs_agmt__: 列表。增强图片集，长为 `(augmented samples)`，每个元素是尺寸为`(height, width, channels)`的图像。
    - __labels_agmt__: 列表。增强图片集，长为`(augmented samples)`，每个元素是分类名字符串。
    - __all_splits__: 整形数，默认为**3**。数据集划分组数。
    - __now_splits__: 整形数，默认为**0**。抽取第**now_splits**为测试集。取值范围为`1--all_splits`。
    - __icld_agmt__: 布尔值，默认为**False**。是否读取增强数据。如果是 None 或 0，不读取增强后的图像，即文件夹名以`_agmt`作为后缀的数据。
- __返回__:
    - __imgs_train__: 整形矩阵。训练样本集，尺寸为 `(samples, height, width, channels)`。
    - __imgs_test__: 整形矩阵。测试样本集，尺寸为 `(tests, height, width, channels)`。
    - __labels_train__: 字符串矩阵。训练样本标签，尺寸为 `(samples,)`，每个元素是分类名称，如dogs。
    - __labels_test__: 字符串矩阵。训练样本标签，尺寸为 `(tests,)`，每个元素是分类名称，如dogs。


- __范例__:

  将`load_all_data`得到的原始数据分割为3份，取第0份为测试集，其余为训练集。同时读取训练集对应的增强数据。

  ```python
  all_splits = 3
  now_splits = 0
  icld_agmt = True

  imgs_train, imgs_test, labels_train, labels_test = train_test_split(
      imgs_orig,
      labels_orig,
      imgs_agmt,
      labels_agmt,
      all_splits,
      now_splits,
      icld_agmt)
  ```
  运行成功时会得到以下结果。

  ```python
  --->开始分割
  分割耗时: 0.634590965615075 s
  总共 3 份 第 0 份
  训练集数: 6380  测试集数: 167
  ```


***

## database_IO.test_valid_split

```
database_IO.test_valid_split(
    imgs_test,
    labels_test,
    test_size=0.2,
    random_state=0)
```

将大测试集分割为验证集和小测试集。

- __参数__:
  - __imgs_test__: 整形矩阵。测试样本集，尺寸为 `(tests, height, width, channels)`。
  - __labels_test__: 字符串矩阵。训练样本标签，尺寸为 `(tests,)`，每个元素是分类名称，如dogs。
  - __test_size__: 整形数或浮点数。小测试样本集的百分比。如为整数则代表测试集的数量。
  - __random_state__: 整形数。随机数种子。
- __返回__:
  - __imgs_valid__: 整形矩阵。验证样本集，尺寸为 `(valids, height, width, channels)`。
  - __imgs_test__: 整形矩阵。测试样本集，尺寸为 `(tests, height, width, channels)`。
  - **labels_valid**: 字符串矩阵。验证样本标签，尺寸为 `(samples,)`，每个元素是分类名称，如dogs。
  - __labels_test__: 字符串矩阵。训练样本标签，尺寸为 `(tests,)`，每个元素是分类名称，如dogs。


- __范例__:

  将大测试集按照1：1的比例分割为验证集和小测试集。

  ```python
  test_size=0.5

  imgs_valid, imgs_test, labels_valid, labels_test = test_valid_split(
      imgs_test, labels_test, test_size)
  ```


 

***

## database_IO.label_str2index

```python
database_IO.test_valid_split(
    labels,
    classes)
```

将字符串矩阵格式的标签按照字典映射为整形矩阵。

- __参数__：
  - __labels__: 字符串矩阵。训练样本标签，尺寸为 `(labels,)`，每个元素是分类名称，如dogs。
  - __classes__: 字典。分类名称，长为 `(classes)`，如`'dogs': 0`。
- __返回__:
  - __labels__: 整形矩阵。训练样本标签，尺寸为 `(labels,)`，每个元素是分类序号，如0。分类名称与序号严格按照**classes**提供的映射关系一一对应。


- __范例__:

  将测试集中的分类名称转换为序号。

  ```python
  test_size=0.5

  imgs_valid, imgs_test, labels_valid, labels_test = test_valid_split(
      imgs_test, labels_test, test_size)
  ```
